<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GraphQL Ruby</title>
    <link rel="stylesheet" href="/stylesheet.css">
    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="Nanoc 4.2.3">
  </head>
  <body class="hack">
    <div class="container">
      <div style="display: flex; justify-content: center;">
<strong style="white-space: pre; line-height: 1.1em; display: inline-block;">
    ▄██████▄     ▄████████    ▄████████    ▄███████▄    ▄█    █▄    ████████▄    ▄█
   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███  ███
   ███    █▀    ███    ███   ███    ███   ███    ███   ███    ███   ███    ███  ███
  ▄███         ▄███▄▄▄▄██▀   ███    ███   ███    ███  ▄███▄▄▄▄███▄▄ ███    ███  ███
 ▀▀███ ████▄  ▀▀███▀▀▀▀▀   ▀███████████ ▀█████████▀  ▀▀███▀▀▀▀███▀  ███    ███  ███
   ███    ███ ▀███████████   ███    ███   ███          ███    ███   ███    ███  ███
   ███    ███   ███    ███   ███    ███   ███          ███    ███   ███  ▀ ███  ███▌    ▄
   ████████▀    ███    ███   ███    █▀   ▄████▀        ███    █▀     ▀██████▀▄█ █████▄▄██
                ███    ███                                                      ▀
</strong>
      </div>
      <p style="text-align: center;">A GraphQL server implementation for Ruby</p>

      <div class="grid -between">
        <div class="cell -3of12">
          <h3><a href="/">Readme</a></h3>
          <h3>Guides</h3>
          <ul>
            <li><a href="/guides/introduction/">Introduction</a></li>
            <li><a href="/guides/defining_your_schema/">Defining a Schema</a></li>
            <li><a href="/guides/executing_queries/">Executing Queries</a></li>
            <li><a href="/guides/code_reuse/">Code Reuse</a></li>
            <li><a href="/guides/security/">Security</a></li>
            <li><a href="/guides/testing/">Testing</a></li>
          </ul>
          <h3><a href="http://www.rubydoc.info/github/rmosolgo/graphql-ruby">API Docs</a></h3>
          <h3><a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a></h3>
        </div>
        <div class="cell -9of12">
          <h1>Executing Queries with <code>graphql-ruby</code></h1>

<p>After you define your schema, you can evaluate queries with <code>GraphQL::Schema#execute</code>.</p>

<p>At the simplest, you can evaluate a query from string against a schema:</p>
<pre class="highlight ruby"><code><span class="c1"># let's pretend it's a Rails controller!</span>
<span class="n">query_string</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:query</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
<span class="n">render</span><span class="p">(</span><span class="ss">json: </span><span class="n">result</span><span class="p">)</span>
</code></pre>
<h2>Variables</h2>

<p>If your query contains variables, you can provide their values with the <code>variables:</code> keyword.</p>
<pre class="highlight ruby"><code><span class="n">query_string</span> <span class="o">=</span> <span class="s2">"query getPost($postId: Int!){ post(id: $postId) { title } }"</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="ss">variables: </span><span class="p">{</span><span class="s2">"postId"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">})</span>
</code></pre>
<p><code>variables</code> keys should be strings, whose names match the variables, without <code>$</code>.</p>

<h2>Context</h2>

<p>You can pass an arbitrary hash of information into the query with the <code>context:</code> keyword.</p>
<pre class="highlight ruby"><code><span class="n">result</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="ss">context: </span><span class="p">{</span><span class="ss">current_user: </span><span class="n">current_user</span><span class="p">})</span>
</code></pre>
<p>These values will be accessible by key inside <code>resolve</code> functions. For example, this field only returns a value if the current user has high enough permissions:</p>
<pre class="highlight ruby"><code><span class="no">SecretStringField</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Field</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">type</span> <span class="o">!</span><span class="no">GraphQL</span><span class="o">::</span><span class="no">STRING_TYPE</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">description</span> <span class="s2">"A string that's only visible to authorized users"</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">resolve</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span> <span class="n">ctx</span><span class="p">[</span><span class="ss">:current_user</span><span class="p">].</span><span class="nf">authorized?</span> <span class="p">?</span> <span class="n">obj</span><span class="p">.</span><span class="nf">secret_string</span> <span class="p">:</span> <span class="kp">nil</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<p>Note that <code>ctx</code> is not the <em>same</em> hash that&#39;s passed to <code>GraphQL::Schema#execute</code>. <code>ctx</code> is an instance of <code>GraphQL::Query::Context</code>, which exposes the provided hash and may <em>also</em> contain other information about the query.</p>

<h2>Operation name</h2>

<p>If your query contains multiple operations, you <em>must</em> pass the operation name with the <code>operation_name:</code> keyword:</p>
<pre class="highlight ruby"><code><span class="n">result</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="ss">operation_name: </span><span class="s2">"getPersonInfo"</span><span class="p">)</span>
</code></pre>
<p>If you don&#39;t, you&#39;ll get an error.</p>

<h2>Validation</h2>

<p>By default, <code>graphql-ruby</code> performs validation on incoming query strings. If you want to disable this, pass <code>validate: false</code>. No guarantees it won&#39;t blow up :)</p>
<pre class="highlight ruby"><code><span class="n">result</span> <span class="o">=</span> <span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="ss">validate: </span><span class="kp">false</span><span class="p">)</span>
</code></pre>
<h2>Custom Execution Strategies</h2>

<p><code>graphql</code> includes a serial execution strategy, but you can also create custom strategies to support advanced behavior. See <code>GraphQL::SerialExecution#execute</code> the required behavior.</p>

<p>Then, set your schema to use your custom execution strategy with <code>GraphQL::Schema#mutation_execution_strategy</code> or <code>GraphQL::Schema#query_execution_strategy</code></p>

<p>For example:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CustomQueryExecutionStrategy</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">root_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># ... define your types ...</span>

<span class="no">MySchema</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">query: </span><span class="no">MyQueryType</span><span class="p">,</span> <span class="ss">mutation: </span><span class="no">MyMutationType</span><span class="p">)</span>
<span class="c1"># Use your custom strategy:</span>
<span class="no">MySchema</span><span class="p">.</span><span class="nf">query_execution_strategy</span> <span class="o">=</span> <span class="no">CustomQueryExecutionStrategy</span>
</code></pre>
        </div>
      </div>
    </div>
  </body>
</html>
